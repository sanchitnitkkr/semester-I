<!DOCTYPE html>
<html>
<body>
<button onclick="start()">Send ultrasonic token</button>

<script>
let ctx;

function start() {
  ctx = new (window.AudioContext || window.webkitAudioContext)();

  function playTone(freq, durationMs) {
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();

    osc.frequency.value = freq;
    osc.type = "sine";
    gain.gain.value = 0.3;

    osc.connect(gain).connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime + durationMs / 1000);
  }

  async function sendBit(bit) {
    playTone(bit ? 19100 : 18800, 80);
    await new Promise(r => setTimeout(r, 100));
  }

  async function sendToken(bits) {
    for (const b of bits) await sendBit(b);
  }

  sendToken([1,0,1,1,0,0,1,0]);
}
</script>
</body>
</html>
